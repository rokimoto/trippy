
<!-- The code in this file pertains to the content of the Location Show Page -->

<!-- Begin Yeilded Content -->

<!-- Flash messages -->
<%= render 'layouts/flash' %>
<!-- end of flash messages -->


<h1><%= @location.name %></h1>

<p><strong>Address</strong>
  <%= @location.address %>
</p>

<% begin %>
  <% @client.display_phone %>
<% rescue %>
<% else %>
  <p><strong>Phone</strong>
    <%= @client.display_phone %>
  </p>
<% end %>


<% if current_user.admin? %>
<%= link_to "Delete", @location, method: :delete, data: {confirm: "Are you sure you want to delete this location?"} %>
<% end %>



<h2>Reviews</h2>
<% if @location.reviews.any? %>
  <% @location.reviews.each do |review| %>
    <p>Name: <%= User.find(review.user_id).username || User.find(review.user_id).name %></p>
    <p>Rating: <% review.rating.to_i.times do %><span class="glyphicon glyphicon-star"><% end %></p>
    <p>Content: <%= review.content %></p>
    <p><%= image_tag review.photo.url if review.photo? %></p>
    <% if current_user.admin?  || review.user_id = current_user.id %>
      <%= link_to "Delete", review, method: :delete, data: {confirm: "Are you sure you want to delete this review?"} %>
    <% end %>
  <% end %>
<% else %>
  <p>No reviews yet!</p>
<% end %>

<p>
  <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
    Add a Review!
  </button>
</p>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Review for <%=@location.name%></h4>
      </div>
      <div class="modal-body">
        <%= form_for [current_user, Review.new] do |f| %>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <%= f.hidden_field :location_id, :value => @location.id %>
          <p>Rating</p>
            <p><%= f.number_field(:rating, options = {in: 1...6}) %></p>
          <p>Content</p>
            <p><%= f.text_area :content %></p>
          <p>Photos</p>
            <p><%= f.file_field :photo, class: "form-control" %></p>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <%= f.submit "Save", class: "btn btn-primary" %>
        <% end %>
      </div>

    </div>
  </div>
</div>

<p>
  <%= link_to "Go Back", locations_path %>
</p>
